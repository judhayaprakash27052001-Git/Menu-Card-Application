<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weekly Menu | Koumatha</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    body {
      background: 
        linear-gradient(rgba(255,255,255,0.88), rgba(255,255,255,0.92)),
        url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1600&q=80') center center/cover no-repeat;
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      color: #222;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .header {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 94vw;
      background: rgba(255,255,255,0.97);
      box-shadow: 0 6px 24px 0 rgba(255,105,135,0.17);
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 32px 0 18px 0;
      border-radius: 0 0 30px 30px;
      animation: fadeInDown 1.2s cubic-bezier(.4,.8,.4,1.2);
    }
    @keyframes fadeInDown {
      0% { opacity: 0; transform: translateY(-80px) translateX(-50%);}
      100% { opacity: 1; transform: translateY(0) translateX(-50%);}
    }
    .logo {
      font-size: 2.4rem;
      font-weight: 700;
      letter-spacing: 2px;
      color: #ff7f50;
      text-shadow: 0 2px 10px rgba(255,105,135,0.15);
      margin-bottom: 6px;
      background: linear-gradient(90deg, #ff7f50 30%, #bfa43a 80%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: logoPop 1.3s cubic-bezier(.4,2,.4,1.7);
    }
    @keyframes logoPop {
      0% {scale:0.6;}
      100% {scale:1;}
    }
    .sub {
      font-size: 1.08rem;
      color: #555;
      margin-bottom: 8px;
      font-weight: 400;
      letter-spacing: 1px;
      text-shadow: 0 1px 6px rgba(255,105,135,0.08);
      animation: fadeInSub 1.5s;
    }
    @keyframes fadeInSub {
      from { opacity: 0;}
      to { opacity: 1;}
    }
    .main-title {
      margin: 130px auto 22px auto;
      font-size: 2.1rem;
      font-weight: 800;
      text-align: center;
      letter-spacing: 1.3px;
      background: linear-gradient(90deg, #ff7f50 40%, #bfa43a 90%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 2px 10px #ffd1a433;
      animation: fadeInSub 1.4s;
    }
    .container {
      margin: 0 auto 44px auto;
      max-width: 600px;
      background: #ffffffcc;
      border-radius: 26px;
      box-shadow: 0 10px 40px rgba(255,105,135,0.13), 0 2px 16px #bfa43a25;
      padding: 30px 22px 55px 22px;
      animation: fadeInContainer 1.2s;
    }
    .customer-info {
      display: flex;
      gap: 18px;
      margin-bottom: 22px;
      align-items: center;
      flex-wrap: wrap;
    }
    .customer-info input {
      font-size: 1.03em;
      border-radius: 8px;
      border: 1.5px solid #bfa43a35;
      padding: 8px 15px;
      background: #fffbe8;
      color: #222;
      font-family: inherit;
      font-weight: 500;
      margin-bottom: 10px;
      width: 46%;
      min-width: 150px;
    }
    .customer-info input:focus {
      border-color: #bfa43a;
      outline: none;
    }
    .day-card {
      border: 1.5px solid #ff7f5025;
      border-radius: 18px;
      margin-bottom: 26px;
      box-shadow: 0 2px 18px #ffd1a433;
      background: #fff;
      transition: box-shadow 0.22s, border-color 0.18s;
      animation: cardPop 0.7s;
    }
    @keyframes cardPop {
      0% { opacity: 0; transform: scale(0.97);}
      100% { opacity: 1; transform: scale(1);}
    }
    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 700;
      font-size: 1.13rem;
      padding: 22px 24px;
      color: #ff7f50;
      cursor: pointer;
      border-radius: 18px 18px 0 0;
      background: linear-gradient(90deg, #fff 75%, #fff8e6 100%);
      user-select: none;
      transition: background 0.2s;
    }
    .day-header .indicator {
      font-size: 1.3em;
      transition: transform 0.3s cubic-bezier(.2,1.5,.6,1);
    }
    .day-card.collapsed .indicator {
      transform: rotate(-90deg);
    }
    .card-content {
      padding: 16px 24px 24px 24px;
      display: none;
      background: #ffffffec;
      border-radius: 0 0 18px 18px;
      animation: fadeInCard 0.5s;
    }
    @keyframes fadeInCard {
      0% {opacity: 0;}
      100% {opacity: 1;}
    }
    .day-card.expanded .card-content {
      display: block;
      animation: fadeInCard 0.7s;
    }
    .meal-title {
      font-weight: 700;
      color: #bfa43a;
      margin: 14px 0 6px 0;
      font-size: 1em;
      letter-spacing: 0.5px;
    }
    .meal-title-nonveg {
      color:#d34f4f !important;
    }
    .menu-multi-row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px 8px;
      align-items: center;
      margin-bottom: 10px;
    }
    .menu-item-checkbox {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #fffbe8;
      border-radius: 8px;
      padding: 5px 12px;
      margin-bottom: 6px;
      border: 1px solid #bfa43a18;
      min-width: 120px;
      box-shadow: 0 2px 8px #bfa43a11;
    }
    .menu-item-checkbox input[type="number"] {
      width: 52px;
      font-size: 0.99em;
      font-weight: 600;
      padding: 4px 6px;
      border-radius: 7px;
      border: 1.5px solid #bfa43a35;
      background: #fff;
      color: #222;
      margin-left: 4px;
    }
    .menu-item-checkbox input[type="checkbox"] {
      accent-color: #bfa43a;
      width: 18px;
      height: 18px;
    }
    .meal-note {
      font-size: 0.97em;
      color: #555;
      margin-top: 2px;
      margin-bottom: 8px;
      font-style: italic;
    }
    .section-custom-box {
      margin: 8px 0 18px 0;
      width: 100%;
      padding: 10px;
      font-size: 1em;
      border-radius: 8px;
      border: 1.5px solid #bfa43a35;
      background: #fffbe8;
      color: #222;
      font-family: inherit;
    }
    .submit-btn {
      width: 100%;
      margin: 38px 0 0 0;
      padding: 18px 0;
      background: linear-gradient(90deg, #ff7f50 70%, #ffd1a4 100%);
      color: #fff;
      font-weight: 700;
      font-size: 1.18em;
      border: none;
      border-radius: 12px;
      box-shadow: 0 2px 16px rgba(255,105,135,0.14);
      cursor: pointer;
      transition: background 0.22s, transform 0.2s;
      position: relative;
      overflow: hidden;
      letter-spacing: 1px;
      animation: btnPop 0.7s;
    }
    @keyframes btnPop {
      0% { transform: scale(0.95);}
      100% { transform: scale(1);}
    }
    .submit-btn:active {
      transform: scale(0.98);
    }
    .submit-btn .loader {
      display: none;
      position: absolute;
      right: 22px;
      top: 50%;
      transform: translateY(-50%);
      width: 26px;
      height: 26px;
      border: 3px solid #ffd1a4;
      border-top: 3px solid #ff7f50;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    .submit-btn.loading .loader {
      display: inline-block;
    }
    @keyframes spin {
      100% { transform: rotate(360deg);}
    }
    .success-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      width: 97vw;
      max-width: 400px;
      background: #fffdf4;
      border-radius: 24px;
      box-shadow: 0 10px 40px #ff7f5044;
      transform: translate(-50%, -50%);
      z-index: 9999;
      padding: 42px 36px 29px 36px;
      text-align: center;
      animation: popupFade 0.7s cubic-bezier(.3,1.2,.3,1.1);
    }
    @keyframes popupFade {
      0% {opacity:0; scale:0.8;}
      100% {opacity:1;scale:1;}
    }
    .success-popup .checkmark {
      font-size: 3em;
      color: #ff7f50;
      margin-bottom: 18px;
      animation: popCheck 0.5s;
    }
    @keyframes popCheck {
      0% {scale:0.1;}
      100% {scale:1;}
    }
    .success-popup .message {
      font-size: 1.22em;
      font-weight: 700;
      color: #222;
      margin-bottom: 14px;
      letter-spacing: 0.5px;
    }
    .success-popup .total-price {
      font-size: 1.18em;
      font-weight: 700;
      color: #ff7f50;
      margin: 18px 0 16px 0;
      background: linear-gradient(90deg, #ff7f50 60%, #bfa43a 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 1px 8px #ffd1a445;
      animation: fadeInSub 0.7s;
    }
    .success-popup .links {
      margin-top: 12px;
      margin-bottom: 10px;
    }
    .success-popup .links a {
      display: inline-block;
      margin: 0 10px;
      color: #ff7f50;
      text-decoration: none;
      font-weight: 700;
      font-size: 1em;
      border-bottom: 2px solid #ffd1a433;
      padding-bottom: 2px;
      transition: color 0.2s, border-color 0.2s;
    }
    .success-popup .links a:hover {
      color: #bfa43a;
      border-color: #bfa43a;
    }
    .qr-payment {
      margin: 25px 0 12px 0;
      text-align: center;
    }
    .qr-label {
      font-weight: 700;
      color: #bfa43a;
      margin-bottom: 6px;
      letter-spacing: 0.7px;
      font-size: 1.02em;
      display: block;
    }
    .qr-img {
      width: 120px;
      height: 120px;
      border-radius: 12px;
      box-shadow: 0 2px 10px #ffd1a433;
      background: #fffbe8;
      margin: 0 auto;
      animation: qrPop 0.7s;
    }
    @keyframes qrPop {
      0% {opacity:0;scale:0.7;}
      100% {opacity:1;scale:1;}
    }
    .close-btn {
      margin-top: 20px;
      background: #ff7f50;
      color: #fff;
      border: none;
      border-radius: 11px;
      padding: 12px 34px;
      font-size: 1.05em;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
      box-shadow: 0 2px 10px #ffd1a433;
    }
    .close-btn:hover {
      background: #bfa43a;
    }
    @media (max-width: 700px) {
      .container { padding: 10px 2vw 34px 2vw;}
      .header {width: 99vw;}
      .success-popup { padding: 24px 4vw 16px 4vw;}
      .menu-multi-row { flex-direction: column;}
      .customer-info input { width: 100%; min-width: 120px;}
      .main-title {font-size: 1.4rem; margin-top: 102px;}
      .section-custom-box { font-size: 0.98em; }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">Koumatha</div>
    <div class="sub">Cloud Kitchen – Home Foods</div>
  </div>
  <div class="main-title">Weekly Menu</div>
  <div class="container">
    <form id="menuForm" autocomplete="off">
      <div class="customer-info">
        <input type="text" name="customer_name" placeholder="Your Name" required />
        <input type="tel" name="customer_mobile" pattern="[0-9]{10,14}" placeholder="Mobile Number" required />
      </div>
      <!-- Day Cards will be injected here -->
    </form>
    <button type="submit" class="submit-btn" id="submitBtn">
      <span id="submitText">Submit</span>
      <span class="loader"></span>
    </button>
  </div>

  <!-- Success Popup -->
  <div class="success-popup" id="successPopup">
    <div class="checkmark">✔️</div>
    <div class="message">Order submitted successfully!</div>
    <div class="total-price" id="totalPrice"></div>
    <div class="links">
      <a href="https://wa.me/919962225337" target="_blank">WhatsApp</a>
      <a href="KoumathaCloudKitchen-App/" target="_blank">Website</a>
    </div>
    <div class="qr-payment">
      <span class="qr-label">Scan to Pay</span>
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=upi://pay?pa=9962225337@ptaxis" class="qr-img" alt="Scan QR to pay">
    </div>
    <button class="close-btn" onclick="closePopup()">Close</button>
  </div>

  <script>
    const formspaceEndpointUrl = "https://formspree.io/f/xblpyrqe";

    const days = [
      "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"
    ];
    const nonVegDays = [2, 6]; // Wednesday & Sunday

    const morningMenu = [
      { name: "Idly", price: 10 },
      { name: "Dosa", price: 20 },
      { name: "Poori", price: 20 },
      { name: "Upma", price: 30 },
      { name: "Chapathi", price: 20 },
      { name: "Pongal Sambar", price: 50 }
    ];
    // Updated Morning Non-Veg section for Wednesday and Sunday
    const morningNonVeg = [
      { name: "Chicken Gravy", price: 80 },
      { name: "Egg Gravy", price: 50 }
    ];
    const lunchVegMenu = [
      { name: "Veg Meals – ₹100", price: 100 }
    ];
    const lunchNote = "Includes Sambar or Vatha Kozhambu — Rasam, Moor, Appam";
    const lunchNonVeg = [
      { name: "Non-Veg Meals – ₹100", price: 100 },
      { name: "Biryani", price: 150 },
      { name: "Chicken 65", price: 80 }
    ];
    const lunchNonVegNote = "Includes Meen Kulambu, Egg, Rasam";
    const dinnerMenu = [
      { name: "Chapathi", price: 20 },
      { name: "Parotta", price: 15 },
      { name: "Poori", price: 20 },
      { name: "Dosa", price: 20 }
    ];
    const dinnerNonVeg = [
      { name: "Egg Gravy", price: 50 },
      { name: "Chicken Gravy", price: 80 }
    ];
    const eggMenu = [
      { name: "Egg (Boiled/Omelette etc.)", price: 20 }
    ];

    function renderMultiSelect(menu, prefix, dayIdx) {
      return menu.map((item, idx) => `
        <div class="menu-item-checkbox">
          <input type="checkbox" id="${prefix}_${dayIdx}_${idx}" name="${prefix}_${dayIdx}_${idx}" data-name="${item.name}" data-price="${item.price}" />
          <label for="${prefix}_${dayIdx}_${idx}">${item.name} <span style="color:#bfa43a;">₹${item.price}</span></label>
          <input type="number" min="1" max="20" value="1" name="${prefix}_${dayIdx}_${idx}_qty" />
        </div>
      `).join('');
    }

    // Build Cards
    const form = document.getElementById('menuForm');
    for (let i = 0; i < days.length; i++) {
      let isNonVeg = nonVegDays.includes(i);
      let card = document.createElement('div');
      card.className = 'day-card collapsed';
      let cardContent = `
        <div class="meal-title">Morning</div>
        <div class="menu-multi-row">
          ${renderMultiSelect(morningMenu, "morning", i)}
        </div>
        <textarea class="section-custom-box" placeholder="Any custom morning request? (optional)" name="morning_custom_${i}"></textarea>
        ${isNonVeg ? `
        <div class="meal-title meal-title-nonveg">Morning Non-Veg Side Dish</div>
        <div class="menu-multi-row">
          ${renderMultiSelect(morningNonVeg, "morning_nonveg", i)}
        </div>
        <textarea class="section-custom-box" placeholder="Any custom morning non-veg Side Dish request? (optional)" name="morning_nonveg_custom_${i}"></textarea>
        ` : ""}
        <div class="meal-title">Lunch</div>
        <div class="meal-note">${lunchNote}</div>
        <div class="menu-multi-row">
          ${renderMultiSelect(lunchVegMenu, "lunch", i)}
        </div>
        <textarea class="section-custom-box" placeholder="Any custom lunch request? (optional)" name="lunch_custom_${i}"></textarea>
        ${isNonVeg ? `
        <div class="meal-title meal-title-nonveg">Lunch Non-Veg</div>
        <div class="meal-note">${lunchNonVegNote}</div>
        <div class="menu-multi-row">
          ${renderMultiSelect(lunchNonVeg, "lunch_nonveg", i)}
        </div>
        <textarea class="section-custom-box" placeholder="Any custom lunch non-veg request? (optional)" name="lunch_nonveg_custom_${i}"></textarea>
        ` : ""}
        <div class="meal-title">Dinner</div>
        <div class="menu-multi-row">
          ${renderMultiSelect(dinnerMenu, "dinner", i)}
        </div>
        <textarea class="section-custom-box" placeholder="Any custom dinner request? (optional)" name="dinner_custom_${i}"></textarea>
        ${isNonVeg ? `
        <div class="meal-title meal-title-nonveg">Dinner Non-Veg Side Dish</div>
        <div class="menu-multi-row">
          ${renderMultiSelect(dinnerNonVeg, "dinner_nonveg", i)}
        </div>
        <textarea class="section-custom-box" placeholder="Any custom dinner non-veg side dish request? (optional)" name="dinner_nonveg_custom_${i}"></textarea>
        ` : ""}
        <div class="meal-title">Egg Section</div>
        <div class="menu-multi-row">
          ${renderMultiSelect(eggMenu, "egg", i)}
        </div>
        <textarea class="section-custom-box" placeholder="Any custom egg request? (optional)" name="egg_custom_${i}"></textarea>
      `;
      card.innerHTML = `
        <div class="day-header" onclick="toggleCard(this)">
          <span>${days[i]}</span>
          <span class="indicator">&#9662;</span>
        </div>
        <div class="card-content">
          ${cardContent}
        </div>
      `;
      form.appendChild(card);
    }

    window.toggleCard = function(headerElem) {
      const card = headerElem.parentElement;
      card.classList.toggle('expanded');
      card.classList.toggle('collapsed');
    }

    function gatherOrderSummary() {
      const name = (document.querySelector('[name="customer_name"]')?.value || '').trim();
      const mobile = (document.querySelector('[name="customer_mobile"]')?.value || '').trim();
      let total = 0;
      let summary = `Name: ${name}\nMobile: ${mobile}\n\n`;

      for (let i = 0; i < days.length; i++) {
        summary += `${days[i]}\n`;
        let meals = { Morning: [], MorningNonVeg: [], Lunch: [], LunchNonVeg: [], Dinner: [], DinnerNonVeg: [], Egg: [], MorningCustom:"", MorningNonVegCustom:"", LunchCustom:"", LunchNonVegCustom:"", DinnerCustom:"", DinnerNonVegCustom:"", EggCustom:"" };
        // Morning
        morningMenu.forEach((item, idx) => {
          const cb = document.querySelector(`[name="morning_${i}_${idx}"]`);
          if (cb && cb.checked) {
            const qty = Math.max(1, Number(document.querySelector(`[name="morning_${i}_${idx}_qty"]`).value));
            total += item.price * qty;
            meals.Morning.push(`${item.name} (Qty: ${qty})`);
          }
        });
        let morningCustom = document.querySelector(`[name="morning_custom_${i}"]`)?.value.trim() || "";
        if (morningCustom) meals.MorningCustom = morningCustom;
        if (nonVegDays.includes(i)) {
          morningNonVeg.forEach((item, idx) => {
            const cb = document.querySelector(`[name="morning_nonveg_${i}_${idx}"]`);
            if (cb && cb.checked) {
              const qty = Math.max(1, Number(document.querySelector(`[name="morning_nonveg_${i}_${idx}_qty"]`).value));
              total += item.price * qty;
              meals.MorningNonVeg.push(`${item.name} (Qty: ${qty})`);
            }
          });
          let morningNonVegCustom = document.querySelector(`[name="morning_nonveg_custom_${i}"]`)?.value.trim() || "";
          if (morningNonVegCustom) meals.MorningNonVegCustom = morningNonVegCustom;
        }
        // Lunch
        lunchVegMenu.forEach((item, idx) => {
          const cb = document.querySelector(`[name="lunch_${i}_${idx}"]`);
          if (cb && cb.checked) {
            const qty = Math.max(1, Number(document.querySelector(`[name="lunch_${i}_${idx}_qty"]`).value));
            total += item.price * qty;
            meals.Lunch.push(`${item.name} (Qty: ${qty})`);
          }
        });
        let lunchCustom = document.querySelector(`[name="lunch_custom_${i}"]`)?.value.trim() || "";
        if (lunchCustom) meals.LunchCustom = lunchCustom;
        if (nonVegDays.includes(i)) {
          lunchNonVeg.forEach((item, idx) => {
            const cb = document.querySelector(`[name="lunch_nonveg_${i}_${idx}"]`);
            if (cb && cb.checked) {
              const qty = Math.max(1, Number(document.querySelector(`[name="lunch_nonveg_${i}_${idx}_qty"]`).value));
              total += item.price * qty;
              meals.LunchNonVeg.push(`${item.name} (Qty: ${qty})`);
            }
          });
          let lunchNonVegCustom = document.querySelector(`[name="lunch_nonveg_custom_${i}"]`)?.value.trim() || "";
          if (lunchNonVegCustom) meals.LunchNonVegCustom = lunchNonVegCustom;
        }
        // Dinner
        dinnerMenu.forEach((item, idx) => {
          const cb = document.querySelector(`[name="dinner_${i}_${idx}"]`);
          if (cb && cb.checked) {
            const qty = Math.max(1, Number(document.querySelector(`[name="dinner_${i}_${idx}_qty"]`).value));
            total += item.price * qty;
            meals.Dinner.push(`${item.name} (Qty: ${qty})`);
          }
        });
        let dinnerCustom = document.querySelector(`[name="dinner_custom_${i}"]`)?.value.trim() || "";
        if (dinnerCustom) meals.DinnerCustom = dinnerCustom;
        if (nonVegDays.includes(i)) {
          dinnerNonVeg.forEach((item, idx) => {
            const cb = document.querySelector(`[name="dinner_nonveg_${i}_${idx}"]`);
            if (cb && cb.checked) {
              const qty = Math.max(1, Number(document.querySelector(`[name="dinner_nonveg_${i}_${idx}_qty"]`).value));
              total += item.price * qty;
              meals.DinnerNonVeg.push(`${item.name} (Qty: ${qty})`);
            }
          });
          let dinnerNonVegCustom = document.querySelector(`[name="dinner_nonveg_custom_${i}"]`)?.value.trim() || "";
          if (dinnerNonVegCustom) meals.DinnerNonVegCustom = dinnerNonVegCustom;
        }
        // Egg Section
        eggMenu.forEach((item, idx) => {
          const cb = document.querySelector(`[name="egg_${i}_${idx}"]`);
          if (cb && cb.checked) {
            const qty = Math.max(1, Number(document.querySelector(`[name="egg_${i}_${idx}_qty"]`).value));
            total += item.price * qty;
            meals.Egg.push(`${item.name} (Qty: ${qty})`);
          }
        });
        let eggCustom = document.querySelector(`[name="egg_custom_${i}"]`)?.value.trim() || "";
        if (eggCustom) meals.EggCustom = eggCustom;
        if (meals.Morning.length)
          summary += `  Morning: ${meals.Morning.join(", ")}\n`;
        if (meals.MorningCustom)
          summary += `  Morning Custom: ${meals.MorningCustom}\n`;
        if (meals.MorningNonVeg.length)
          summary += `  Morning Non-Veg: ${meals.MorningNonVeg.join(", ")}\n`;
        if (meals.MorningNonVegCustom)
          summary += `  Morning Non-Veg Custom: ${meals.MorningNonVegCustom}\n`;
        if (meals.Lunch.length)
          summary += `  Lunch: ${meals.Lunch.join(", ")}\n`;
        if (meals.LunchCustom)
          summary += `  Lunch Custom: ${meals.LunchCustom}\n`;
        if (meals.LunchNonVeg.length)
          summary += `  Lunch Non-Veg: ${meals.LunchNonVeg.join(", ")}\n`;
        if (meals.LunchNonVegCustom)
          summary += `  Lunch Non-Veg Custom: ${meals.LunchNonVegCustom}\n`;
        if (meals.Dinner.length)
          summary += `  Dinner: ${meals.Dinner.join(", ")}\n`;
        if (meals.DinnerCustom)
          summary += `  Dinner Custom: ${meals.DinnerCustom}\n`;
        if (meals.DinnerNonVeg.length)
          summary += `  Dinner Non-Veg: ${meals.DinnerNonVeg.join(", ")}\n`;
        if (meals.DinnerNonVegCustom)
          summary += `  Dinner Non-Veg Custom: ${meals.DinnerNonVegCustom}\n`;
        if (meals.Egg.length)
          summary += `  Egg Section: ${meals.Egg.join(", ")}\n`;
        if (meals.EggCustom)
          summary += `  Egg Custom: ${meals.EggCustom}\n`;
        summary += "\n";
      }
      summary += `Total Price: ₹${total}\n`;
      return { summary, total, name, mobile };
    }

    // Submit Logic
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const successPopup = document.getElementById('successPopup');
    const totalPriceElem = document.getElementById('totalPrice');
    submitBtn.onclick = function(e) {
      e.preventDefault();
      if (submitBtn.classList.contains('loading')) return;

      // Validate customer info
      const name = document.querySelector('[name="customer_name"]').value.trim();
      const mobile = document.querySelector('[name="customer_mobile"]').value.trim();
      if (!name || !mobile) {
        alert("Please enter your name and mobile number.");
        return;
      }
      submitBtn.classList.add('loading');
      submitText.textContent = "Submitting...";

      const { summary, total } = gatherOrderSummary();

      const payload = {
        customer_name: name,
        customer_mobile: mobile,
        orderSummaryText: summary,
        totalPrice: total,
        meta: {
          submittedAt: new Date().toISOString()
        }
      };

      fetch(formspaceEndpointUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(resp => resp.ok ? resp.json() : Promise.reject())
      .catch(()=>{}) // Ignore errors for now
      .finally(() => {
        submitBtn.classList.remove('loading');
        submitText.textContent = "Submit";
        totalPriceElem.textContent = `Total Price: ₹${total}`;
        successPopup.style.display = 'block';
        window.scrollTo({top:0, behavior:'smooth'});
      });
    };

    window.closePopup = function() {
      successPopup.style.display = 'none';
      document.getElementById('menuForm').reset();
      document.querySelectorAll('.day-card').forEach(card=>{
        card.classList.remove('expanded');
        card.classList.add('collapsed');
      });
    };
  </script>
</body>
</html>

